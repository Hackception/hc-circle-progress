<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-styles/default-theme.html">
<link rel="import" href="./svg-progress-behavior.html">

<!--
`hc-square-progress`
Polymer-based web component displaying a circular progress bar.

@demo demo/index.html
-->

<dom-module id="hc-square-progress">
  <template>

    <style>
      :host {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;

        --hc-progress-square-size: 100px;

        width: var(--hc-progress-square-size);
        height: var(--hc-progress-square-size);
      }
      ::slotted(*) {
        width: var(--hc-progress-square__slot, var(--hc-progress-square-size));
        height: var(--hc-progress-square__slot, var(--hc-progress-square-size));
      }

      svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;

        display: none;
      }

      #square {
        display: block;
      }

      .square__trail {
        stroke: var(--hc-square-progress-bg-stroke-color, --paper-grey-100);
      }

      .square__progress {
        stroke: var(--hc-square-progress-stroke-color, --accent-color);
        stroke-linecap: var(--hc-square-progress-stroke-linecap);
      }
      .animate {
        transition: var(--hc-progress-square__progress-transitions, stroke-dashoffset 1400ms ease-in-out);
      }
    </style>

    <svg id="square">
      <rect class="square__trail"
        width$="[[_width]]"
        height$="[[_height]]"
        fill="transparent"
        stroke-width$="[[strokeWidth]][[strokeUnit]]"
        />
      <rect id="progressPath"
        class="square__progress"
        width$="[[_width]]"
        height$="[[_height]]"
        fill="transparent"
        stroke-width$="[[strokeWidth]][[strokeUnit]]"
        stroke-dasharray$="[[_dasharray]]"
        stroke-dashoffset$="[[_dashoffset]]"
        transform$="[[_transform]]"
        />
    </svg>

    <slot></slot>

  </template>
  <script>

    Polymer({
      is: 'hc-square-progress',

      behaviors: [
        hc.SvgProgressBehavior
      ],

      properties: {
        overlayStroke: {
          type: Boolean,
          observer: '_redrawPath'
        },
        _width: {
          type: Number,
          value: null
        },

        _height: {
          type: Number,
          value: null
        }
      },

      listeners: {
        "iron-resize": "_redrawPath"
      },
      observers: [
        'update(_width, _height)'
      ],

      _redrawPath() {
        if (this.offsetWidth && this.offsetHeight) {
          this._width = this.offsetWidth;
          this._height = this.offsetHeight;

          if (!this.overlayStroke) {
            this.updateStyles({
              '--hc-progress-square__slot': `${(this._width - this.strokeWidth)}px`
            });
          }
        }
      },

      update(width, height) {
        if (!width || !height) { return; }
                  console.log('update')

        this.updateProgress();
      },

      ready() {
        setTimeout(() => {
          this.value = 60;
        },5400);
        // setTimeout(() => {
        //   this.value = 99;
        // },2400);
      }
    });

  </script>
</dom-module>
