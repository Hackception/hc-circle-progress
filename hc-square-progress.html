<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-styles/default-theme.html">
<link rel="import" href="./svg-progress-behavior.html">

<!--
`hc-square-progress`
Polymer-based web component displaying a circular progress bar.

@demo demo/index.html
-->

<dom-module id="hc-square-progress">
  <template>

    <style>
      :host {
        @apply(--layout-vertical);
        @apply(--layout-center-center);

        position: relative;

        width: 80px;
        height: 80px;
        margin: 24px;

        border-radius: 50%;
      }

      svg {
        position: absolute;
        top: 0;
        left: 0;

        display: none;
      }

      .Circle-background {
        stroke: var(--hc-square-progress-bg-stroke-color, --paper-grey-100);
      }

      .Circle-foreground {
        transition: stroke-dashoffset 150ms;

        stroke: var(--hc-square-progress-stroke-color, --accent-color);
        stroke-linecap: var(--hc-square-progress-stroke-linecap);
      }
    </style>

    <svg id="square" width="100%" height="100%">
      <rect class="Circle-background"
          width$="[[_cx]]"
          height$="[[_cy]]"
          fill="transparent"
          stroke-width$="[[strokeWidth]][[strokeUnit]]"
          />
      <rect class="Circle-foreground"
        id="circle-fg"
          width$="[[_cx]]"
          height$="[[_cy]]"
          fill="transparent"
          stroke-width$="[[strokeWidth]][[strokeUnit]]"
          stroke-dasharray$="[[_dasharray]]"
          stroke-dashoffset$="[[_dashoffset]]"
          />
    </svg>

    <slot></slot>

  </template>
  <script>

    Polymer({
      is: 'hc-square-progress',

      behaviors: [
        hc.SvgProgressBehavior
      ],

      properties: {
        /**
         * Starting angle of the progress.
         */
        angle: {
          type: Number,
          value: -90
        },

        _cx: {
          type: Number,
          value: null
        },

        _cy: {
          type: Number,
          value: null
        },

        // _radius: {
        //   type: Number,
        //   computed: '_computeRadius(_cx, _cy, strokeWidth)'
        // },

        // _transform: {
        //   type: String,
        //   computed: '_computeTransform(angle, _cx, _cy)'
        // }
      },

      listeners: {
        "iron-resize": "_onIronResize"
      },

      _computeRadius: function(cx, cy, strokeWidth) {
        return cx && cy ? Math.max(0, Math.min(cx, cy) - strokeWidth / 2) : 0;
      },

      _computeTransform: function(angle, cx, cy) {
        return cx && cy ? 'rotate(' + angle + ', ' + cx + ', ' + cy + ')' : '';
      },

      _onIronResize: function() {
        if (this.offsetWidth && this.offsetHeight) {
          this._computeDashArray(this.$['circle-fg']);
          this._cx = this.offsetWidth;
          this._cy = this.offsetHeight;
          this.$.square.style.display = 'block';
        }
      }
    });

  </script>
</dom-module>
