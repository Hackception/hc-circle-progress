<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="svg-util-behavior.html">

<script>
  /* global hc */
  // Ensure our namespace is available
  window.hc = window.hc || {};

  /** @polymerBehavior */
  hc.SvgProgressBehavior = [Polymer.IronResizableBehavior, hc.SvgUtilBehavior, {
    properties: {
      /**
       * Minimum value
       */
      min: {
        type: Number,
        value: 0
      },
      /**
       * Value of circular progress bar.
       */
      value: {
        type: Number,
        value: 0,
        reflectToAttribute: true
      },
      /**
       * Maximum of value.
       */
      max: {
        type: Number,
        value: 100
      },
      /**
       * Stroke width of circle.
       */
      strokeWidth: {
        type: Number,
        value: 4
      },

      _dasharray: {
        type: Number
      },

      _dashoffset: {
        type: Number,
        computed: '_computeDashOffset(min, value, max, _dasharray)'
      },
      _animationClass: {
        type: String,
        value: 'animate'
      },
      __progressPath: {
        type: Object,
        value() {
          return this.$.progressPath;
        }
      },
    },
    observers: [
      '_setAnimationClass(_animationClass, _dashoffset)'
    ],

    _setAnimationClass(animationClass, dashoffset) {
      if (!isNaN(parseFloat(dashoffset))) {
        Polymer.RenderStatus.afterNextRender(this, () => {
          this.__progressPath.classList.add(animationClass);
        });
      }
    },

    // Calculate the dash-array
    _getDashArray(el) {
      const t = this.getTotalLength(el);
      console.log(t)
      return t;
    },

    /**
     * Calculate the dash-offset
     *
     * @param {Number} min
     * @param {Number} value
     * @param {Number} max
     * @param {Number} dasharray - Size of the total path length
     * @returns {Number} progress of the dasharray
     * @private
     */
    _computeDashOffset(min, value, max, dasharray) {
      if (!value || !dasharray || !max) return dasharray;
      return (dasharray - (((value - min) / (max - min)) * dasharray)) || dasharray;
    },

    updateProgress() {
      this._dasharray = this._getDashArray(this.__progressPath);
    }

  }];

</script>
